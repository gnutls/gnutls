\chapter{How to use \gnutls{}\index{Example programs} in applications}

\input{preparation}

\label{examples}
\section{Client examples}
This section contains examples of \tls{} and \ssl{} clients, using \gnutls{}. 
Note that these examples contain little or no error checking.

\subsection{Simple client example with X.509 certificate support}
Let's assume now that we want to create a TCP client which communicates
with servers that use X.509 or OpenPGP certificate authentication. The following client
is a very simple \tls{} client, it does not support session resuming, not
even certificate verification. The TCP functions defined in this example
are used in most of the other examples below, without redefining them.
\input{ex-client2}

\subsection{Obtaining session information}
Most of the times it is desirable to know the security properties of
the current established session. This includes the underlying ciphers and
the protocols involved. That is the purpose of the following function.
Note that this function will print meaningful values only if
called after a successful \printfunc{gnutls_handshake}{gnutls\_handshake}

\input{ex-session-info}

\subsection{Verifying peer's certificate}
A \tls{} session is not secure just after the handshake procedure has finished.
It must be considered secure, only after the peer's certificate and identity have been
verified. That is, you have to verify the signature in peer's 
certificate, the hostname in the certificate, and expiration dates.
Just after this step you should treat the connection as being a secure one.
The following function is a simple example on how to verify a single certificate.
Real world programs should be able to handle certificate chains as well.

\input{ex-rfc2818}

\subsection{Using a callback to select the certificate to use}
There are cases where a client holds several certificate and key pairs,
and may not want to load all of them in the credentials structure.
The following example demonstrates the use of the certificate selection callback.
\par

\input{ex-cert-select}


\subsection{Client with Resume capability example}
\label{resume-example}
This is a modification of the simple client example. Here we demonstrate
the use of session resumption. The client tries to connect once using
\tls{}, close the connection and then try to establish a new connection
using the previously negotiated data.
\input{ex-client-resume}

\subsection{Simple client example with SRP authentication}
The following client
is a very simple SRP \tls{} client which connects to a server 
and authenticates using a {\it username} and a {\it password}. The
server may authenticate itself using a certificate, and in that case it
has to be verified.
\input{ex-client-srp}

\section{Server examples}
This section contains examples of \tls{} and \ssl{} servers, using \gnutls{}.

\subsection{Echo Server with X.509 authentication}
This example is a very simple echo server which supports {\bf X.509} authentication,
using the RSA ciphersuites.
\input{ex-serv1}

\subsection{Echo Server with X.509 authentication II}
The following example is a server which supports {\bf X.509} authentication.
This server supports the export-grade cipher suites, the DHE ciphersuites
and session resuming.
\input{ex-serv-export}

\subsection{Echo Server with OpenPGP\index{OpenPGP!Server} authentication}
The following example is an echo server which supports {\bf OpenPGP} key 
authentication. You can easily combine this functionality --that is have
a server that supports both X.509 and OpenPGP certificates-- but we
separated them to keep these examples as simple as possible.
\input{ex-serv-pgp}


\subsection{Echo Server with SRP authentication}
This is a server which supports {\bf SRP} authentication. It is also
possible to combine this functionality with a certificate server. Here it
is separate for simplicity.
\input{ex-serv-srp}

\section{Miscellaneous examples}

\subsection{Checking for an alert}
This is a function that checks if an alert has been received
in the current session.
\input{ex-alert}

\subsection{X.509 certificate parsing example}
\label{ex:x509-info}
To demonstrate the X.509 parsing capabilities an example program is listed below.
That program reads the peer's certificate, and prints information about it.
\input{ex-x509-info}

\subsection{Certificate request generation}
\label{ex:crq}
The following example is about generating a certificate request, and
a private key. A certificate request can be later be processed by a CA,
which should return a signed certificate.

\subsection{PKCS \#12 structure generation}
\label{ex:pkcs12}
The following example is about generating a PKCS \#12 structure.

\input{ex-pkcs12}

\input{ex-crq}


\input{openssl}
